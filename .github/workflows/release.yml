name: Build and Release

on:
  push:
    tags:
      - 'v*'  # v1.0.0, v1.1.0 などのタグでトリガー
  workflow_dispatch:  # 手動実行も可能

permissions:
  contents: write  # リリース作成に必要な権限

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # リポジトリをチェックアウト
      - name: Checkout repository
        uses: actions/checkout@v4

      # リソースパックディレクトリをZIP化して.mcpackファイルを作成
      # .mcpackファイルは実際にはZIPファイルで、拡張子が異なるだけ
      - name: Create mcpack package
        run: |
          cd resource_packs/Numeric_Blocks
          zip -r ../../Numeric_Blocks.mcpack ./*

      # ビルド成果物をGitHub Actionsにアップロード
      # アーティファクトは自動的に.zipで圧縮されるが、元のファイル名は保持される
      - name: Upload mcpack artifact
        uses: actions/upload-artifact@v4
        with:
          name: Numeric_Blocks  # アーティファクト名(.zipが自動追加されるため拡張子なし)
          path: Numeric_Blocks.mcpack
          retention-days: 90

      # タグがプッシュされた場合のみ、GitHubリリースを作成
      # Releasesページに.mcpackファイルが添付される
      - name: Create Release
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v2
        with:
          files: Numeric_Blocks.mcpack
          draft: false
          prerelease: false
          generate_release_notes: true  # コミット履歴から自動的にリリースノートを生成
          make_latest: true  # 最新リリースとしてマーク
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
